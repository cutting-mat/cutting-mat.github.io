# 路由结构

路由结构一方面是站点页面结构的自然体现，另外路由结构也要满足访问控制相关功能（比如用户鉴权、权限控制）的需求。

从访问控制的角度，框架将路由分成**主路由与旁路路由**。以模板项目为例，首页及其所有子路由组成主路由，除首页外主模块也可以包含其他路由或子路由，这些就是旁路路由，不受访问限制。

结合这两个角度，框架的路由结构设计如下图所示：

![路由结构设计](/assets/img/路由结构设计.png)

## 主路由与旁路路由

从路由结构上看，主路由包括首页及其所有下级子路由，旁路路由指与首页平级的其他路由。

主路由与旁路路由是从访问控制的角度延申出的概念，所谓旁路是指不受访问限制的区域，而主路自然就是被访问控制系统所覆盖的区域。

框架内置两种访问控制功能，用户鉴权(`account-auth`)和权限控制（`access-control`），分别实现账号已登录/未登录的可访问性和基于角色的动态账号权限控制，它们会自动将旁路路由加入白名单，让旁路路由成为系统中的可随意访问的**公共区域**。

关于访问控制功能的详细信息可以参考文档相关内容。

主路与旁路的区分，是通过以下约定隐式体现在路由配置中的：

1. **主模块数组的第一个对象必须是首页('/')路由**
2. **业务模块路由将自动挂载为首页('/')的子路由，组成主路由；主模块除首页外的其余路由为旁路路由**

## 配置路由

理解了以上概念，配置路由就很简单。只需要在路由配置文件（`@/route.config.js`）中指定`mainModule`（主模块）和`subModules`（业务模块），剩下的框架会自动处理。

```js
// 主模块
import main from '@/main/index'
import bypass from '@/bypass'

export const mainModule = [
    ...main,            // 除根路由'/'外全部是旁路路由
    ...bypass           // 旁路模块
] 

// 业务模块
import system from '@/system'
import user from '@/user'

export const subModules =  [
    ...system,          // 业务模块会自动挂载为根路由'/'的children
    ...user,
]

```

## 动态菜单

实际项目中路由数据也可以用于实现站点的导航菜单，在不开启前端权限控制（`access-control`）的情况下，路由配置中的`subModules`数组实际上也可以作为站点导航菜单的数据源，而且可以灵活配置模块顺序和`meta`信息，实现自定义展示效果。

```js
// 业务模块路由可以用于实现导航菜单
import { subModules } from "@/route.config";

```

开启权限控制的情况下，权限控制模块会将当前账号的合法路由存入状态数据（`state.menu`），方便业务中使用。

```js
// state.menu 存储动态路由权限
data(){
    return {
        menu: this.$store.state.menu
    }
}
```

## 动态模板

